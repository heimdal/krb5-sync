.\" Automatically generated by Pod::Man 2.27 (Pod::Simple 3.28)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
.    ds C`
.    ds C'
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.\"
.\" Avoid warning from groff about undefined register 'F'.
.de IX
..
.nr rF 0
.if \n(.g .if rF .nr rF 1
.if (\n(rF:(\n(.g==0)) \{
.    if \nF \{
.        de IX
.        tm Index:\\$1\t\\n%\t"\\$2"
..
.        if !\nF==2 \{
.            nr % 0
.            nr F 2
.        \}
.    \}
.\}
.rr rF
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "KRB5-SYNC-BACKEND 8"
.TH KRB5-SYNC-BACKEND 8 "2013-12-09" "3.0" "krb5-sync"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
krb5\-sync\-backend \- Manipulate Kerberos password and status change queue
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
\&\fBkrb5\-sync\-backend\fR (help|manual)
.PP
\&\fBkrb5\-sync\-backend\fR (disable|enable) [\fB\-d\fR \fIqueue\fR] \fIuser\fR
.PP
\&\fBkrb5\-sync\-backend\fR list [\fB\-d\fR \fIqueue\fR]
.PP
\&\fBkrb5\-sync\-backend\fR process [\fB\-s\fR] [\fB\-d\fR \fIqueue\fR]
.PP
\&\fBkrb5\-sync\-backend\fR password [\fB\-d\fR \fIqueue\fR] \fIuser\fR ad < \fIpassword\fR
.PP
\&\fBkrb5\-sync\-backend\fR purge [\fB\-d\fR \fIqueue\fR] \fIdays\fR
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
\&\fBkrb5\-sync\-backend\fR provides an interface to the queue of pending
password and account status changes written by either this utility or by
the synchronization plugin after failures.  It can queue account enables,
disables, or password changes for Active Directory, list the queued
actions, or process the queued actions with \fBkrb5\-sync\fR (telling it to
take its action from a file).
.PP
The queue directory will contain files with names in the format:
.PP
.Vb 1
\&    <username>\-<domain>\-<action>\-<timestamp>\-<count>
.Ve
.PP
where <username> is the name of the affected account (\f(CW\*(C`/\*(C'\fR will be
replaced with \f(CW\*(C`.\*(C'\fR in the file name and the realm will be removed),
<domain> is \f(CW\*(C`ad\*(C'\fR, <action> is either \f(CW\*(C`enable\*(C'\fR (used for both enabling
and disabling accounts) or \f(CW\*(C`password\*(C'\fR, <timestamp> is a \s-1ISO 8601\s0
timestamp in \s-1UTC,\s0 and <count> is a two-digit zero-padded number between 0
and 99 (so that we can handle multiple changes that arrive in the same
second).  Each file contains a queued change in the format described in
\&\fIkrb5\-sync\fR\|(8).
.PP
Supported arguments to \fBkrb5\-sync\-backend\fR are:
.IP "disable \fIuser\fR" 4
.IX Item "disable user"
Queue a disable action (in Active Directory, as that's the only system
currently supported for enable and disable) for \fIuser\fR.
.IP "enable \fIuser\fR" 4
.IX Item "enable user"
Queue an enable action (in Active Directory, as that's the only system
currently supported for enable and disable) for \fIuser\fR.
.IP "help" 4
.IX Item "help"
List the supported commands.
.IP "list" 4
.IX Item "list"
List the current contents of the queue.
.IP "manual" 4
.IX Item "manual"
Display this documentation.
.IP "process" 4
.IX Item "process"
Process the queue.  All queued actions will be sorted alphanumerically
(which due to the timestamp means that all changes for a particular user of
a particular type will be done in the order queued).  \fBkrb5\-sync\fR will be
called for each queued action, as long as it continues to succeed.  If it
fails for a queued action, all other actions sharing the same username,
domain, and action will be skipped and queue processing will continue with
the next action that differs in one of those three parameters.
.IP "password \fIuser\fR ad < \fIpassword\fR" 4
.IX Item "password user ad < password"
Queue a password change for \fIuser\fR in Active Directory, setting their
password to \fIpassword\fR.  By default, \fIpassword\fR is read from standard input.
It can also be passed as a command-line argument, but this is less secure
since the password is then readable by anyone on the system who can see the
command-line arguments of processes.
.Sp
The entire standard input is taken as the password, including any trailing
newlines, so be careful how the password is provided.  If using something like
\&\fBecho\fR, use \f(CW\*(C`echo \-n\*(C'\fR or the \f(CW\*(C`\ec\*(C'\fR flag, depending on your system.
.IP "purge \fIdays\fR" 4
.IX Item "purge days"
Delete all queued actions last modified longer than \fIdays\fR days ago.  This
can be used to clean up old failed change propagations in situations where
accounts may be created or have password changes queued that are later
removed and never created in other environments.
.SH "OPTIONS"
.IX Header "OPTIONS"
Options must be specified after the command.
.IP "\fB\-d\fR \fIqueue\fR, \fB\-\-directory\fR=\fIqueue\fR" 4
.IX Item "-d queue, --directory=queue"
Use \fIqueue\fR as the queue directory instead of the default of
\&\fI/var/spool/krb5\-sync\fR.  This also changes the lock file accordingly.  This
option is supported for all commands except \f(CW\*(C`help\*(C'\fR and \f(CW\*(C`manual\*(C'\fR.
.IP "\fB\-s\fR, \fB\-\-silent\fR" 4
.IX Item "-s, --silent"
This option is only allowed for the \f(CW\*(C`process\*(C'\fR command.  Filter out the
output of \fBkrb5\-sync\fR to ignore common errors and success messages and
only show uncommon errors.  This option will filter out all output when
\&\fBkrb5\-sync\fR is successful and will filter out error messages that
normally indicate the account is missing in Active Directory.  The regexes
can be modified at the start of this script.
.SH "FILES"
.IX Header "FILES"
.IP "\fI/usr/sbin/krb5\-sync\fR" 4
.IX Item "/usr/sbin/krb5-sync"
The path to the \fBkrb5\-sync\fR utility.  This may be changed at the top of
this script.
.IP "\fI/var/spool/krb5\-sync\fR" 4
.IX Item "/var/spool/krb5-sync"
The default path to the queue.  This must match the queue_dir parameter in
\&\fIkrb5.conf\fR used by the plugin.  It can be changed at the top of this
script.
.IP "\fI/var/spool/krb5\-sync/.lock\fR" 4
.IX Item "/var/spool/krb5-sync/.lock"
An empty file used for locking the queue.  When writing to or querying the
queue, \fBkrb5\-sync\-backend\fR will open and lock this file with the Perl flock
function, which normally calls \fIflock\fR\|(2).  Any other queue writers need to
use the same locking mechanism for safe operation.
.SH "AUTHOR"
.IX Header "AUTHOR"
Russ Allbery <eagle@eyrie.org>
.SH "COPYRIGHT AND LICENSE"
.IX Header "COPYRIGHT AND LICENSE"
Copyright 2007, 2008, 2010, 2012, 2013 The Board of Trustees of the Leland
Stanford Junior University
.PP
Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the \*(L"Software\*(R"),
to deal in the Software without restriction, including without limitation
the rights to use, copy, modify, merge, publish, distribute, sublicense,
and/or sell copies of the Software, and to permit persons to whom the
Software is furnished to do so, subject to the following conditions:
.PP
The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.
.PP
\&\s-1THE SOFTWARE IS PROVIDED \*(L"AS IS\*(R", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL
THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
DEALINGS IN THE SOFTWARE.\s0
.SH "SEE ALSO"
.IX Header "SEE ALSO"
\&\fIkrb5\-sync\fR\|(8)
.PP
The current version of this program is available from its web page at
<http://www.eyrie.org/~eagle/software/krb5\-sync/>.
